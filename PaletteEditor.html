<!DOCTYPE html>
<html lang="en">
<html>
<head>
	<meta charset="utf-8">
	<title>Edit palettes</title>
	<script type="text/javascript" src="jquery-ui/external/jquery/jquery.js"></script>
	<script type="text/javascript"  src="jquery-ui/jquery-ui.js"></script>
	<link href="jquery-ui/jquery-ui.css" rel="stylesheet">
	<link href="mstone.css" rel="stylesheet">
	<script type="text/javascript"  src="lib/chroma.js"></script>
	<script type="text/javascript"  src="lib/d3.v3.js"></script>
	<script type="text/javascript"  src="lib/colorEditorUtils.js"></script>
</head>
<style>
	.control-group {
		display: inline-flex;
		margin-right: 15px;
		margin-bottom: 10px;
	}
	.vContainer {
		margin-left: 20px;
	}
	
	.sliderLabel {
		width: 15px;
		align-item: center;
	}
	#hue, #sat, #val {
		width: 360px;
		margin: 10px;
		display: inline-block;
	}
	#cieL,#cieC,#cieH {
		width: 360px;
		margin: 10px;
		display: inline-block;
	}
	#swatch {
		width: 120px;
		height: 120px;
		margin-left: 10px;
	}
	#hue .ui-slider-range { background: #b7b7b7; }
	#sat .ui-slider-range { background: #b7b7b7; }
	#val .ui-slider-range { background: #b7b7b7; }
	#cieL .ui-slider-range { background: #b7b7b7; }
	#cieC .ui-slider-range { background: #b7b7b7; }
	#cieH .ui-slider-range { background: #b7b7b7; }
	</style>  	

<script type="text/javascript" charset="utf-8">

//This initializes the foreground colors

state = {}
state.colors = []
state.pColor = chroma('#000000')	//actually set in the .ready function
state.selectedPt = null

state.hex = ['#1C642B','#3E6385','#6B6F5D','#8BA552','#61A7A5','#66BEC6','#87ACEC','#93A87A','#303F32','#415A27','#477E17','#554CBC','#629F5A','#658A21','#793AA2','#836B1F','#890E01','#0879B2','#4881BC','#5693EF','#7385B9','#7655CE','#17487A','#59562C','#013600','#213848','#353028','#713713','#919468','#A29CBB','#A133B1','#A857AA','#A9713C','#A86392','#AD9042','#B52E38','#BDA983','#C7B3C1','#C67036','#DDB590','#F46829','#FC1F05']

formatTriple = function(t,p) {
	s = ""
	s = s+Math.round(t[0]).toPrecision(p)+", "
	s = s+Math.round(t[1]).toPrecision(p)+", "
	s = s+Math.round(t[2]).toPrecision(p)
	return s
}
initDisplay = function() {
	//updateAllSliders()
	updateColor()
	displayColors("#plots")	
}

updateDisplay = function() {
	displayColors("#plots")
}

function slideHSVSliders() {
    var hue= $( "#hue" ).slider( "value" )
    var sat = $( "#sat" ).slider( "value" )
    var val = $( "#val" ).slider( "value" )
	state.pColor = chroma.hsv(hue,sat,val)
	updateColor("hsvSlider")
  }
function changeHSVSliders() {
	console.log("changed LCH Slider")
}	
function slideLCHSliders() {
    var L= $( "#cieL" ).slider( "value" )
    var C = $( "#cieC" ).slider( "value" )
    var H = $( "#cieH" ).slider( "value" )
	state.pColor = chroma.lch(L,C,H)
	updateColor("lchSlider")
  }
function changeLCHSliders() {
	console.log("changed LCH Slider")
}
updateHSVSliders = function() {
	var hsv = state.pColor.hsv()
	$("#hue").slider("option","value",hsv[0])
	$("#sat").slider("option","value",hsv[1])
	$("#val").slider("option","value",hsv[2])
}
updateLCHSliders = function() {
	var lch = state.pColor.lch()
	$("#cieL").slider("option","value",lch[0])
	$("#cieC").slider("option","value",lch[1])
	$("#cieH").slider("option","value",lch[2])
}
updateAllSliders = function() {
	updateLCHSliders()
	updateHSVSliders()
}
//UX has updated state.pColor. Now propogate the changes
updateColor = function(type) {
	var hex = state.pColor.hex()
	var hsv = state.pColor.hsv()
	var lch = state.pColor.lch()
	/*hsv[0] = Math.round(hsv[0])
	hsv[1] = Math.round((hsv[1]*100))/100
	hsv[2] = Math.round((hsv[2]*100))/100*/
	//text and patch can be updated in all cases, no loops
   $("#hex-text").val(hex)
   $("#hsv-text").val(formatTriple(hsv))
   $('#lch-text').val(formatTriple(lch))
   	state.luminance = state.pColor.luminance()
   $("#lum-text").val(state.luminance.toPrecision(3))
   $(".change-color").css("background-color", hex) //patch
   updateAllSliders()
  /* if (type == "hsvSlider") {updateLCHSliders()}
	if (type == "lchSlider") {updateHSVSliders()}*/

   if (state.selectedPt != null) {	//this is an svg object
	 var cIndex = parseInt(state.selectedPt.attr('cIndex'))
	 state.colors[cIndex].color = state.pColor
	 updateDisplay()  //does a full replot 
	}
  }

$(document).ready(function() {
	state.colors = createColors(state.hex)
	state.pColor = chroma.hsv(270,0.7,0.7)
	$("#hue").slider({
      orientation: "horizontal",
      range: "min",
      max: 359,
	  step: 0.5,
      slide: slideHSVSliders,
		stop: slideHSVSliders,
      change: changeHSVSliders
    });
	$( "#sat,#val" ).slider({
      orientation: "horizontal",
      range: "min",
      max: 1,
	  step: 0.001,
      slide: slideHSVSliders,
		stop: slideHSVSliders,
      change: changeHSVSliders
    })
	$( "#cieL" ).slider({
      orientation: "horizontal",
      range: "min",
      max: 100,
	  step: 0.5,
      slide: slideLCHSliders,
		stop: slideLCHSliders,
      change: changeLCHSliders
    })
	$( "#cieC" ).slider({
      orientation: "horizontal",
      range: "min",
      max: 140,
	  step: 0.5,
      slide: slideLCHSliders,
		stop: slideLCHSliders,
      change: changeLCHSliders
    })
	$("#cieH").slider({
      orientation: "horizontal",
      range: "min",
      max: 359,
	  step: 0.5,
      slide: slideLCHSliders,
		stop: slideLCHSliders,
      change: changeLCHSliders
    });
		$("#hex-text").keypress(function(event) {
		if (event.keyCode == 13) {
            var v= $("#hex-text").val()
			state.pColor = chroma(v)
			updateColor("text")
		}
	})
	initDisplay()
  });
	


displayColors = function() {
	
	d3.select('#plots').selectAll("svg").remove();
	//create the tooltip
	var tooltip = d3.select("body")
	.append("div")
	.attr("id", "tooltip")
	.style("position", "absolute")
	.style("z-index", "10")
	.style("visibility", "hidden")
	.style("background-color",'white')
	.style("margin","2px")
	.text("a simple tooltip")
	
	//For point plotting, various constants 
	var abSize = 800;
	var lWidth = 100;
	var pSize = 9;
	var pW = pSize*3
	var pH = pSize/3
	
	var xOrg = abSize/2
	var yOrg = abSize/2
	
	ab2xy = function(a,b) {
		var x = xOrg+Math.round((abSize/300)*a)
		var y = yOrg-Math.round((abSize/300)*b)
		return a,b
	}
	hex2tip = function(hex) {
		var c = chroma(hex)
		var lch = c.lch()
		var tip = formatTriple(lch,3)
		return tip
	}
	
//create the svg frames. Will eventually add axes, etc. here
	var svg_ab = d3.select("#abPlot")
		.append("svg")
		.attr("width", abSize).attr("height",abSize)
		.style("border", "1px solid lightgray")
	var svg_L = d3.select("#LPlot")
		.append("svg")
		.attr("width", lWidth).attr("height",abSize)
		.style("border", "1px solid lightgray")
	svg_ab.append("line").attr("x1", 0).attr("y1", yOrg)
		.attr("x2",abSize).attr("y2",yOrg)
		.style({stroke: "lightgray", "stroke-width": "1px"})
	svg_ab.append("line").attr("x1", xOrg).attr("y1",0)
		.attr("x2",xOrg).attr("y2",abSize)
		.style({stroke: "lightgray", "stroke-width": "1px"})
//loop over the colors
	for (i = 0; i<state.colors.length; i++) {
		var d = state.colors[i]
		var lab = d.color.lab()
		var hex = d.color.hex()
		var tip = hex2tip(hex)
		var scale = 1.0
		if (d.selected) {scale = 1.5}
//a,b points
		var svgPt = svg_ab.append("circle")
		.attr("r", pSize*scale)
		.attr("cx", xOrg+Math.round((abSize/300)*lab[1]))
		.attr("cy", yOrg-Math.round((abSize/300)*lab[2]))
		.attr("fill",hex)
		.attr("tip",tip)
		.attr('cIndex',i)
		addActions(svgPt)
		
//L* points
		svgPt = svg_L.append("rect")
		.attr("width",pW*scale)
		.attr("height", pH)
		.attr("x", (lWidth-pW)/2)
		.attr("y", abSize-Math.round((abSize/100)*lab[0]))
		.attr("fill",hex)
		.attr("tip",tip)
		.attr('cIndex',i)
		addActions(svgPt)

	}	
}

findColorItem = function(svgPt) {
	var cIndex = parseInt(state.selectedPt.attr('cIndex'))
	return state.colors[cIndex]
}

addActions = function(svgPt) {
	var tooltip = d3.select('#tooltip')
	svgPt.on("mouseover", function(){
			tooltip.text(d3.select(this).attr("tip"))
			return tooltip.style("visibility", "visible")})
		.on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px")})
		.on("mouseout", function(){return tooltip.style("visibility", "hidden")})
		.on('click', function() {
			var pt = d3.select(this)
			state.pColor = chroma(pt.attr("fill"))
			if (state.selectedPt != null) {
				c = findColorItem(state.selectedPt)
				c.selected = false
			}
			state.selectedPt = pt
			c = findColorItem(pt)
			c.selected = true
			updateColor("point")
		})
}

 </script>
</head>
<body>
<div style = "margin: 20px">
<h2>Start of a palette editor</h2>
<div class='hContainer' id='controls'>
<!-- HSV sliders -->
	<div class = "vContainer">
		<div class = 'hContainer'>
			<div class='sliderLabel'>H: </div> 
			<div id="hue"></div>
		</div>
		<div class = 'hContainer'>
			<div class='sliderLabel'>S: </div> 
			<div id="sat"></div>
		</div>
		<div class = 'hContainer'>
			<div class='sliderLabel'>V: </div> 
			<div id="val"></div>
		</div>
	</div>
	<div id="swatch" class="change-color"></div>
<!-- LCh sliders -->
	<div class = "vContainer">
		<div class = 'hContainer'>
			<div class='sliderLabel'>L: </div> 
			<div id="cieL"></div>
		</div>
		<div class = 'hContainer'>
			<div class='sliderLabel'>C: </div> 
			<div id="cieC"></div>
		</div>
		<div class = 'hContainer'>
			<div class='sliderLabel'>H: </div> 
			<div id="cieH"></div>
		</div>
	</div>
	<div class = "vContainer" >
	<div class = "control-group">
		<div style="width: 40px;">Hex: </div>
		<input type="text" class = "smallText" id="hex-text" name="hex-text" style = "width: 60px;"/></div>
	<div class = "control-group">
		<div style="width: 40px;">HSV: </div>
		<input type="text" class = "smallText" id="hsv-text" name="hsv-text" style = "width: 100px;"/></div>
		<div class = "control-group">
		<div style="width: 40px;">LCH: </div>
		<input type="text" class = "smallText" id="lch-text" name="lch-text" style = "width: 100px;"/></div>
	<div class="control-group"> 
		<div style="width: 40px;">Lum:</div>
		<input type="text" id="lum-text" name="lum-text" class = "smallText" style = "width: 60px;"/>
	</div>
</div>
</div>
<div class="hContainer" id = 'plots'>
	<div id = "abPlot" style="margin: 5px; width=300px"></div>
	<div id = "LPlot" style="margin: 5px"></div>
</div>
</body>
</html>

<!-- Created by Maureen Stone</a>.-->